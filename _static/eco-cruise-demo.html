<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Eco-Cruise Optimization Visualization</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent: #0ea5e9;  /* sky-500 */
      --muted:  #e5e7eb;  /* neutral-200 */
    }
    body { font-family: 'Inter', sans-serif; background:#fafafa; }
    .car-svg { filter: drop-shadow(0 2px 4px rgba(0,0,0,.15)); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    /** --- 1) SVG car (reuse for both lanes) --- **/
    const CarSVG = () => (
      <svg viewBox="0 0 2000 1000" className="w-full h-full car-svg">
        <g>
          <path fill="#4CAF50" d="M1429.1,368.9L1429.1,368.9c22.9,86.1,22.9,176.6,0,262.7l0,0c-7,26.3-84.9,44.6-112,44.6H696.3 c-36.8,0-106-22.4-119.6-56.6l0,0c-30.6-76.6-30.6-162,0-238.6l0,0c13.7-34.2,82.8-56.6,119.6-56.6h620.8 C1344.3,324.3,1422.2,342.6,1429.1,368.9z"/>
          <path fill="#45a049" d="M1409.4,374.9L1409.4,374.9c21.8,82.1,21.8,168.5,0,250.7l0,0c-6.7,25.1-81,42.5-106.9,42.5H710.3 c-35.1,0-101.1-21.4-114.1-54l0,0c-29.2-73.1-29.2-154.6,0-227.7l0,0c13-32.6,79-54,114.1-54h592.2 C1328.4,332.4,1402.7,349.9,1409.4,374.9z"/>
          <path fill="#2E7D32" d="M818.2,672.2l20.3,35.9c3.4,6.1,9.9,9.8,16.9,9.8l0,0c2.8,0,4.8-2.7,4.1-5.3l-11-40.4H818.2z"/>
          <path fill="#2E7D32" d="M818.2,328.3l20.3-35.9c3.4-6.1,9.9-9.8,16.9-9.8l0,0c2.8,0,4.8,2.7,4.1,5.3l-11,40.4H818.2z"/>
          <path fill="#46484B" d="M1060.6,656.5c1.1,0,2.2,0,3.3,0c86.7,0,173.3-5.4,173.3-5.4s-63.1-21.6-86.6-21.6h-84.9 C1063.6,638.4,1061.9,647.5,1060.6,656.5z"/>
          <path fill="#46484B" d="M1055.7,629.5h-79.1c-13.5,0-86,21.6-86,21.6s76.1,4.8,157.1,5.3C1049.9,647.4,1052.7,638.4,1055.7,629.5z"/>
          <path fill="#46484B" d="M1060.6,343.9c1.1,0,2.2,0,3.3,0c86.7,0,173.3,5.4,173.3-5.4s-63.1-21.6-86.6-21.6h-84.9 C1063.6,362.1,1061.9,353,1060.6,343.9z"/>
          <path fill="#46484B" d="M1055.7,371h-79.1c-13.5,0-86-21.6-86-21.6s76.1-4.8,157.1-5.3C1049.9,353.1,1052.7,362.1,1055.7,371z"/>
          <path fill="#46484B" d="M953.1,619.6L827.7,652c0,0-47.8-34.3-47.8-151.8s47.8-151.8-47.8-151.8l125.4,32.5 c0,0-15.3,65.5-15.3,119.3S953.1,619.6,953.1,619.6z M1230.7,391.1c4.5,19.7,13.8,69.9,13.8,109.1s-9.2,89.5-13.8,109.1 c-1.2,5.3,2.7,10.3,8.1,10.5l114.4,4c3.1,0.1,6.1-1.5,7.7-4.2c27.2-45.9,23.4-119.4,23.4-119.4s3.8-73.6-23.4-119.4 c-1.6-2.7-4.6-4.3-7.7-4.2l-114.4,4C1233.4,380.7,1229.5,385.8,1230.7,391.1z"/>
          <path fill="#87CEEB" d="M639.8,652c-6.7-26.9-37.3-44.3-45.3-43.2c4.3,7.8,9.5,14.9,15.9,21.3C618.7,638.5,628.7,645.8,639.8,652z"/>
          <path fill="#87CEEB" d="M639.8,348.5c-6.7,26.9-37.3,44.3-45.3,43.2c4.3-7.8,9.5-14.9,15.9-21.3 C618.7,361.9,628.7,354.6,639.8,348.5z"/>
          <path fill="#FFD700" d="M1416.7,608.9c-3.5,10-9.6,19.2-17.9,26.8c-2.1,2-4.5,3.9-5.8,6.3c-0.9,1.7-1.2,3.7-0.7,5.5 c16.6-10.6,28.1-26.8,30.9-45.4c-0.1,0-0.1,0-0.2,0C1419.5,602.2,1417.8,605.9,1416.7,608.9z"/>
          <path fill="#FFD700" d="M1416.7,391.6c-3.5-10-9.6-19.2-17.9-26.8c-2.1-2-4.5-3.9-5.8-6.3c-0.9-1.7-1.2-3.7-0.7-5.5 c16.6,10.6,28.1,26.8,30.9,45.4c-0.1,0-0.1,0-0.2,0C1419.5,398.3,1417.8,394.6,1416.7,391.6z"/>
          <path fill="#46484B" d="M582.4,546.5v-92.6c0-11.2-1.4-22.1-3.9-32.5c-8,11.8-12.3,25.7-12.3,40V539c0,14.3,4.3,28.2,12.3,40 C581,568.6,582.4,557.7,582.4,546.5z"/>
        </g>
      </svg>
    );

    /** --- 2) Generic Car wrapper --- **/
    const CAR_W = 80;
    const CAR_H = 40;

    const Car = ({ style }) => (
      <div className="absolute transition-transform duration-100"
           style={{ top: '42px', width: CAR_W, height: CAR_H, ...style }}>
        <CarSVG />
      </div>
    );

    /** --- 2.5) Front bumper cost bar component --- **/
    const FrontBar = ({ left, d, beta = 1.0, gamma = 0.1 }) => {
      const k = 40;                              // pixels per unit cost (visual scale)
      const u = d?.acceleration ?? 0;
      const v = d?.velocity ?? 0;

      const accel = 0.5 * beta * u * u;
      const speed = 0.5 * gamma * v * v;

      const accelW = accel * k;
      const speedW = speed * k;
      const totalW = Math.max(accelW + speedW, 18);   // minimum visibility

      const stripe =
        Math.abs(u) < 1e-6 ? 'rgba(107,114,128,0.6)' : // gray
        (u > 0 ? 'rgba(14,165,233,0.7)' : 'rgba(239,68,68,0.7)'); // teal / red

      return (
        <div
          className="absolute h-3 rounded overflow-hidden ring-1 ring-neutral-300/60"
          style={{ top: '54px', left, width: `${totalW}px`, zIndex: 60, background: 'transparent' }}
        >
          {/* Acceleration term */}
          <div className="h-full bg-sky-500/35" style={{ width: `${accelW}px`, display: 'inline-block' }} />
          {/* Speed term */}
          <div className="h-full bg-neutral-700/25" style={{ width: `${speedW}px`, display: 'inline-block' }} />
          {/* Control sign stripe (thin) */}
          <div className="absolute top-0 left-0 right-0" style={{ height: '2px', background: stripe }} />
        </div>
      );
    };

    /** --- 3) Main component --- **/
    const EcoCruiseOptimization = () => {
      const [trajectoryData, setTrajectoryData] = React.useState(null);
      const [isAnimating, setIsAnimating] = React.useState(false);
      const [currentFrame, setCurrentFrame] = React.useState(0);
      const [showSummary, setShowSummary] = React.useState(false);
      const [errorMessage, setErrorMessage] = React.useState('');
      const [isLoading, setIsLoading] = React.useState(true);

      const animationRef = React.useRef(null);
      const fileInputRef = React.useRef(null);

      const ecoRoadRef = React.useRef(null);
      const ecoStartRef = React.useRef(null);
      const ecoFinishRef = React.useRef(null);
      const naiveRoadRef = React.useRef(null);
      const naiveStartRef = React.useRef(null);
      const naiveFinishRef = React.useRef(null);

      const [ecoGeom, setEcoGeom] = React.useState(null);
      const [naiveGeom, setNaiveGeom] = React.useState(null);

      // Load default trajectory data on component mount
      React.useEffect(() => {
        const loadDefaultData = async () => {
          try {
            setIsLoading(true);
            // Determine the correct path based on current location
            const currentPath = window.location.pathname;
            let dataPath;
            
            if (currentPath.includes('/_static/')) {
              // If we're in _static directory (embedded in book), use same directory
              dataPath = 'trajectory_data.json';
            } else {
              // If we're at root level (opened directly), use _static
              dataPath = '_static/trajectory_data.json';
            }
            
            const response = await fetch(dataPath);
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            loadTrajectoryData(data);
          } catch (error) {
            setErrorMessage('Could not load default data from trajectory_data.json. You can upload a file manually.');
          } finally {
            setIsLoading(false);
          }
        };
        loadDefaultData();
      }, []);

      React.useLayoutEffect(() => {
        if (!trajectoryData) return;
        const measure = () => {
          const mk = (roadRef, startRef, finishRef) => {
            if (!roadRef.current || !startRef.current || !finishRef.current) return null;
            const road = roadRef.current.getBoundingClientRect();
            const start = startRef.current.getBoundingClientRect();
            const finish = finishRef.current.getBoundingClientRect();
            return {
              startX: start.left - road.left,
              finishX: finish.left - road.left,
              width: road.width
            };
          };
          setEcoGeom(mk(ecoRoadRef, ecoStartRef, ecoFinishRef));
          setNaiveGeom(mk(naiveRoadRef, naiveStartRef, naiveFinishRef));
        };
        setTimeout(measure, 100);
        window.addEventListener('resize', measure);
        return () => window.removeEventListener('resize', measure);
      }, [trajectoryData]);

      const handleFileLoad = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        if (!file.name.toLowerCase().endsWith('.json')) {
          setErrorMessage('Please upload a valid .json file');
          fileInputRef.current.value = '';
          return;
        }
        const reader = new FileReader();
        reader.onload = (evt) => {
          try {
            const data = JSON.parse(evt.target.result);
            loadTrajectoryData(data);
            fileInputRef.current.value = '';
          } catch (error) {
            setErrorMessage('Invalid JSON file: ' + error.message);
          }
        };
        reader.readAsText(file);
      };

      const loadTrajectoryData = (data) => {
        try {
          if (!data.eco_trajectory || !data.naive_trajectory) {
            throw new Error('Missing trajectory arrays');
          }
          setTrajectoryData(data);
          setErrorMessage('');
          resetAnimation();
        } catch (error) {
          setErrorMessage('Error loading data: ' + error.message);
        }
      };

      const startAnimation = () => {
        if (!trajectoryData) return;
        setIsAnimating(true);
        setCurrentFrame(0);
        setShowSummary(false);

        const totalFrames = trajectoryData.eco_trajectory.length;
        const animate = (frame) => {
          if (frame >= totalFrames) {
            finishAnimation();
            return;
          }
          setCurrentFrame(frame);
          animationRef.current = setTimeout(() => animate(frame + 1), 150);
        };
        animate(0);
      };

      const finishAnimation = () => {
        setIsAnimating(false);
        setShowSummary(true);
        if (animationRef.current) clearTimeout(animationRef.current);
      };

      const resetAnimation = () => {
        setIsAnimating(false);
        setCurrentFrame(0);
        setShowSummary(false);
        if (animationRef.current) clearTimeout(animationRef.current);
      };



      const updateCarPosition = (position, velocity, maxVelocity, totalDistance, geom) => {
        if (!geom) return { visibility: 'hidden', left: '0px' };
        const progress = Math.min(position / totalDistance, 1);
        const travel = geom.finishX - geom.startX;
        const xCenter = geom.startX + progress * travel;
        const scale = 0.9;
        const xLeft = xCenter - CAR_W / 2;
        return {
          left: `${xLeft}px`,
          transform: `scale(${scale})`,
          transformOrigin: 'center center',
          zIndex: 100,
          pointerEvents: 'none',
          visibility: 'visible'
        };
      };

      const updateGauge = (value, maxValue) => {
        const pct = Math.min(Math.max(value / maxValue, 0), 1) * 100;
        const rotation = (pct / 100) * 360;
        return `conic-gradient(from 0deg, var(--accent) 0deg, var(--accent) ${rotation}deg, var(--muted) ${rotation}deg)`;
      };

      const getCurrentData = () => {
        if (!trajectoryData || currentFrame >= trajectoryData.eco_trajectory.length) {
          return {
            eco: { position: 0, velocity: 0, acceleration: 0, stageCost: 0, cumulativeEnergy: 0 },
            naive: { position: 0, velocity: 0, acceleration: 0, stageCost: 0, cumulativeEnergy: 0 }
          };
        }
        return {
          eco: trajectoryData.eco_trajectory[currentFrame],
          naive: trajectoryData.naive_trajectory[currentFrame]
        };
      };

      const currentData = getCurrentData();
      const params = trajectoryData?.parameters || {};
      const totalDistance = params.distance || 1000;
      const maxVelocity = params.v_max || 20;
      const maxEnergy = trajectoryData
        ? Math.max(
            trajectoryData.eco_trajectory.slice(-1)[0].cumulativeEnergy,
            trajectoryData.naive_trajectory.slice(-1)[0].cumulativeEnergy
          ) - Math.min(
            trajectoryData.eco_trajectory[0].cumulativeEnergy,
            trajectoryData.naive_trajectory[0].cumulativeEnergy
          )
        : 100;

      const ecoStyle = updateCarPosition(
        currentData.eco.position,
        currentData.eco.velocity,
        maxVelocity,
        totalDistance,
        ecoGeom
      );

      const naiveStyle = updateCarPosition(
        currentData.naive.position,
        currentData.naive.velocity,
        maxVelocity,
        totalDistance,
        naiveGeom
      );

      // Lead (front-bumper) x positions for trails
      const ecoLeadLeft = `${parseFloat(ecoStyle.left || '0') + CAR_W + 2}px`;
      const naiveLeadLeft = `${parseFloat(naiveStyle.left || '0') + CAR_W + 2}px`;

      const getSummaryText = () => {
        if (!trajectoryData) return '';
        const ecoFinal = trajectoryData.eco_trajectory.slice(-1)[0];
        const naiveFinal = trajectoryData.naive_trajectory.slice(-1)[0];
        return `Smart Eco Driver used ${ecoFinal.cumulativeEnergy.toFixed(1)} energy vs ` +
               `${naiveFinal.cumulativeEnergy.toFixed(1)} for Naive. ` +
               `Savings: ${trajectoryData.energy_savings_percent.toFixed(1)}%.`;
      };

      return (
        <div className="min-h-screen bg-neutral-50 p-6">
          <div className="max-w-6xl mx-auto bg-white rounded-2xl p-8 shadow">
            <h1 className="text-4xl font-bold text-gray-900 mb-3">Eco-Cruise Optimization</h1>
            <p className="text-lg text-gray-600 mb-4">
              Load your JSON trajectory file below to visualize the optimized vs naive drive.
            </p>

            {/* Cost bar explanation */}
            <div className="mb-6 p-3 bg-gray-50 rounded-lg border border-gray-200">
              <p className="text-xs text-gray-600">
                <strong>Front bar legend:</strong> Length ∝ cₜ = ½βuₜ² + ½γvₜ² (teal = accel term, gray = speed term). Top stripe shows control sign (teal = throttle, red = brake).
              </p>
            </div>

            {/* Data Input */}
            <div className={`rounded-xl p-6 mb-6 border ${trajectoryData ? 'border-sky-200 bg-sky-50' : 'border-neutral-200 bg-white'}`}>
              <h3 className="text-xl font-semibold mb-4">
                {trajectoryData ? 'Trajectory Data Loaded' : 'Load Trajectory Data'}
              </h3>

              {isLoading ? (
                <div className="flex items-center justify-start p-2">
                  <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-sky-500"></div>
                  <span className="ml-3 text-gray-600">Loading default trajectory data…</span>
                </div>
              ) : (
                <>
                  <p className="text-sm text-gray-600 mb-3">
                    {trajectoryData
                      ? 'Default trajectory data loaded. Upload another file to compare.'
                      : 'Upload a JSON trajectory file to visualize the eco-cruise optimization.'}
                  </p>
                  <input
                    ref={fileInputRef}
                    type="file"
                    accept=".json,application/json"
                    onChange={handleFileLoad}
                    className="p-2 border border-neutral-300 rounded-lg bg-white"
                  />
                </>
              )}

              {errorMessage && (<p className="text-red-600 mt-2">{errorMessage}</p>)}
            </div>

            {/* Controls */}
            <div className="flex justify-start gap-3 mb-8 flex-wrap">
              <button
                onClick={startAnimation}
                disabled={!trajectoryData || isAnimating || isLoading}
                className="px-5 py-2 rounded-lg text-white bg-sky-600 hover:bg-sky-700 disabled:bg-neutral-300 disabled:text-white"
              >
                Start
              </button>
              <button
                onClick={resetAnimation}
                className="px-5 py-2 rounded-lg bg-neutral-100 hover:bg-neutral-200 text-gray-800"
              >
                Reset
              </button>
            </div>

            {/* Simulation Visualization */}
            {trajectoryData && !isLoading && (
              <div className="space-y-10 mb-6">
                {/* Eco Driver */}
                <div className="p-6 rounded-xl bg-white border border-neutral-200 relative overflow-hidden shadow-sm">
                  <div className="text-2xl font-semibold text-gray-800 mb-4">Smart Eco Driver</div>

                  <div ref={ecoRoadRef} className="relative h-32 bg-neutral-100 rounded-xl mb-6 overflow-hidden">
                    {/* Road surface */}
                    <div className="absolute top-12 left-0 right-0 h-8 bg-neutral-300 rounded" />
                    {/* Center dashed line (subtle) */}
                    <div className="absolute top-[3.75rem] left-0 right-0 h-[2px] opacity-70"
                         style={{ background: 'repeating-linear-gradient(to right, #fff 0 16px, transparent 16px 32px)' }} />
                    {/* Start/finish markers (KEEP for geometry) */}
                    <div ref={ecoStartRef} className="absolute left-1 top-8 bottom-8 w-px bg-neutral-300" />
                    <div ref={ecoFinishRef} className="absolute right-1 top-8 bottom-8 w-px bg-neutral-300" />

                    <Car style={ecoStyle} />

                    {/* Front bumper cost bar */}
                    {ecoStyle.visibility !== 'hidden' && (
                      <FrontBar
                        left={ecoLeadLeft}
                        d={currentData.eco}
                        beta={params?.beta ?? 1.0}
                        gamma={params?.gamma ?? 0.1}
                      />
                    )}
                  </div>

                  {/* Eco metrics */}
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="w-20 h-20 mx-auto mb-2 relative">
                        <div className="w-full h-full rounded-full bg-neutral-200" />
                        <div className="absolute top-0 left-0 w-full h-full rounded-full"
                             style={{ background: updateGauge(currentData.eco.velocity, maxVelocity) }} />
                        <div className="absolute inset-0 flex items-center justify-center font-semibold text-gray-800">
                          {currentData.eco.velocity.toFixed(1)}
                        </div>
                      </div>
                      <div className="text-sm text-gray-600 font-medium">Speed (m/s)</div>
                    </div>
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="w-20 h-20 mx-auto mb-2 relative">
                        <div className="w-full h-full rounded-full bg-neutral-200" />
                        <div className="absolute top-0 left-0 w-full h-full rounded-full"
                             style={{ background: updateGauge(Math.max(0, 100 - ((currentData.eco.cumulativeEnergy - (trajectoryData?.eco_trajectory[0]?.cumulativeEnergy || 0)) / maxEnergy * 100)), 100) }} />
                        <div className="absolute inset-0 flex items-center justify-center font-semibold text-gray-800 text-xs">
                          {Math.max(0, 100 - ((currentData.eco.cumulativeEnergy - (trajectoryData?.eco_trajectory[0]?.cumulativeEnergy || 0)) / maxEnergy * 100)).toFixed(0)}%
                        </div>
                      </div>
                      <div className="text-sm text-gray-600 font-medium">Energy Remaining</div>
                    </div>
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="w-full h-2 bg-neutral-200 rounded mb-2">
                        <div className="h-full rounded bg-sky-500 transition-all"
                             style={{ width: `${(currentData.eco.position / totalDistance) * 100}%` }} />
                      </div>
                      <div className="text-sm text-gray-600 font-medium">Progress</div>
                      <div className="text-lg font-semibold text-gray-800">{Math.round(currentData.eco.position)} m</div>
                    </div>
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="text-sm text-gray-600 font-medium">Energy Used</div>
                      <div className="text-lg font-semibold text-gray-800">{currentData.eco.cumulativeEnergy.toFixed(1)}</div>
                    </div>
                  </div>
                </div>

                {/* Naive Driver */}
                <div className="p-6 rounded-xl bg-white border border-neutral-200 relative overflow-hidden shadow-sm">
                  <div className="text-2xl font-semibold text-gray-800 mb-4">Naive Driver</div>

                  <div ref={naiveRoadRef} className="relative h-32 bg-neutral-100 rounded-xl mb-6 overflow-hidden">
                    {/* Road surface */}
                    <div className="absolute top-12 left-0 right-0 h-8 bg-neutral-300 rounded" />
                    {/* Center dashed line */}
                    <div className="absolute top-[3.75rem] left-0 right-0 h-[2px] opacity-70"
                         style={{ background: 'repeating-linear-gradient(to right, #fff 0 16px, transparent 16px 32px)' }} />
                    {/* Start/finish markers (KEEP for geometry) */}
                    <div ref={naiveStartRef} className="absolute left-1 top-8 bottom-8 w-px bg-neutral-300" />
                    <div ref={naiveFinishRef} className="absolute right-1 top-8 bottom-8 w-px bg-neutral-300" />

                    <Car style={naiveStyle} />

                    {/* Front bumper cost bar */}
                    {naiveStyle.visibility !== 'hidden' && (
                      <FrontBar
                        left={naiveLeadLeft}
                        d={currentData.naive}
                        beta={params?.beta ?? 1.0}
                        gamma={params?.gamma ?? 0.1}
                      />
                    )}
                  </div>

                  {/* Naive metrics */}
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="w-20 h-20 mx-auto mb-2 relative">
                        <div className="w-full h-full rounded-full bg-neutral-200" />
                        <div className="absolute top-0 left-0 w-full h-full rounded-full"
                             style={{ background: updateGauge(currentData.naive.velocity, maxVelocity) }} />
                        <div className="absolute inset-0 flex items-center justify-center font-semibold text-gray-800">
                          {currentData.naive.velocity.toFixed(1)}
                        </div>
                      </div>
                      <div className="text-sm text-gray-600 font-medium">Speed (m/s)</div>
                    </div>
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="w-20 h-20 mx-auto mb-2 relative">
                        <div className="w-full h-full rounded-full bg-neutral-200" />
                        <div className="absolute top-0 left-0 w-full h-full rounded-full"
                             style={{ background: updateGauge(Math.max(0, 100 - ((currentData.naive.cumulativeEnergy - (trajectoryData?.naive_trajectory[0]?.cumulativeEnergy || 0)) / maxEnergy * 100)), 100) }} />
                        <div className="absolute inset-0 flex items-center justify-center font-semibold text-gray-800 text-xs">
                          {Math.max(0, 100 - ((currentData.naive.cumulativeEnergy - (trajectoryData?.naive_trajectory[0]?.cumulativeEnergy || 0)) / maxEnergy * 100)).toFixed(0)}%
                        </div>
                      </div>
                      <div className="text-sm text-gray-600 font-medium">Energy Remaining</div>
                    </div>
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="w-full h-2 bg-neutral-200 rounded mb-2">
                        <div className="h-full rounded bg-neutral-500 transition-all"
                             style={{ width: `${(currentData.naive.position / totalDistance) * 100}%` }} />
                      </div>
                      <div className="text-sm text-gray-600 font-medium">Progress</div>
                      <div className="text-lg font-semibold text-gray-800">{Math.round(currentData.naive.position)} m</div>
                    </div>
                    <div className="bg-white p-4 rounded-xl text-center border border-neutral-200">
                      <div className="text-sm text-gray-600 font-medium">Energy Used</div>
                      <div className="text-lg font-semibold text-gray-800">{currentData.naive.cumulativeEnergy.toFixed(1)}</div>
                    </div>
                  </div>
                </div>
              </div>
            )}

            {/* Summary */}
            {showSummary && (
              <div className="bg-sky-600 text-white p-6 rounded-xl text-center">
                <h3 className="text-2xl font-semibold mb-2">Results</h3>
                <p className="text-lg">{getSummaryText()}</p>
              </div>
            )}
          </div>
        </div>
      );
    };

    // Render the component
    ReactDOM.render(<EcoCruiseOptimization />, document.getElementById('root'));
  </script>
</body>
</html>
